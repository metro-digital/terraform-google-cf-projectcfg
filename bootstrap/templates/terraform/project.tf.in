# Copyright 2021 METRO Digital GmbH
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

module "project-cfg" {
  source     = "github.com/metro-digital/terraform-google-cf-projectcfg.git?ref=latest"
  project_id = "${GCP_PROJECT_ID}"

  roles = {
    "roles/viewer" = [
      "${IAM_MANAGER_GROUP}",
      "${IAM_DEVELOPER_GROUP}"
    ],
    "roles/cloudsupport.techSupportEditor" = [
      "${IAM_MANAGER_GROUP}"
    ]
    "roles/compute.networkAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/vpcaccess.admin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/compute.securityAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/storage.admin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/storage.objectAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/iam.serviceAccountKeyAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/iam.serviceAccountAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/iam.securityAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/iam.roleAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
    "roles/serviceusage.serviceUsageAdmin" = [
      "serviceAccount:${SA_FULL_NAME}"
    ]
  }

  service_accounts = {
    "${SA_SHORT_NAME}" = {
      display_name = "Service account used in IaC pipelines"
      iam          = {} # No special Service Account resource IAM permissions
    }
  }

  ## List of vpc regions to configure and how to set them up
  ## (default is europe-west1 only without Serverless VPC Access or NAT)
  #vpc_regions = {
  #  europe-west1 = {
  #    vpcaccess = true # Enable serverless VPC access for this region
  #    nat       = 1    # Create a Cloud NAT with 1 (static) external IP address (IPv4) in this region
  #  },
  #  europe-west3 = {
  #    vpcaccess = false # Disable serverless VPC access for this region
  #    nat       = 0     # No Cloud NAT for this region
  #  },
  #}

  ## List of enabled services
  #enabled_services = [
  #  "bigquery.googleapis.com",
  #  "compute.googleapis.com",
  #  "cloudscheduler.googleapis.com",
  #  "iap.googleapis.com"
  #]
}
